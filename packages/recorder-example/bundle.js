!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=2)}([function(e,t,n){t.Promise=window.Promise||n(1),t.XMLHttpRequest=window.XMLHttpRequest||function(){return new ActiveXObject("Microsoft.XMLHTTP")};var r=/(input|textarea)/,o=/(checkbox|radio)/,i=Array.prototype.forEach;t.forEach=function(e,t){if(i)i.call(e,t);else for(var n=0;n<e.length;n++)t(e[n],n)};var a=Array.prototype.map;t.map=function(e,t){var n=[];if(a)return a.call(e,t);for(var r=0;r<e.length;r++)n.push(t(e[r],r));return n},t.hash=function(){return Math.random().toString(16).substr(2,8)},t.addEventListener=function(e,t,n){function r(e){n(e,e.target||e.srcElement)}e.addEventListener?e.addEventListener(t,r,!0):e.attachEvent("on"+t,r)},t.getTextSlice=function(e,t){var n;return void 0===t&&(t=60),(n=r.test(e.tagName.toLowerCase())?function(e){var t=e.labels;return t&&t[0]?t[0].textContent?t[0].textContent:t[0].innerText:o.test(e.type)?null:e.value}(e):function(e){return e.textContent?e.textContent:e.innerText}(e))?function(e,t){var n=String(e).replace(/^\s+|\s+$/g,""),r=n.search(/\r?\n/);return-1!==r&&(n=n.substr(0,r)),n.length>t?n.substr(0,t-1)+"...":n}(n,t):null}},function(e,t,n){"use strict";var r=setTimeout;function o(){}function i(e){if(!(this instanceof i))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],l(e,this)}function a(e,t){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,i._immediateFn(function(){var n=1===e._state?t.onFulfilled:t.onRejected;if(null!==n){var r;try{r=n(e._value)}catch(e){return void c(t.promise,e)}u(t.promise,r)}else(1===e._state?u:c)(t.promise,e._value)})):e._deferreds.push(t)}function u(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if(t instanceof i)return e._state=3,e._value=t,void s(e);if("function"==typeof n)return void l((r=n,o=t,function(){r.apply(o,arguments)}),e)}e._state=1,e._value=t,s(e)}catch(t){c(e,t)}var r,o}function c(e,t){e._state=2,e._value=t,s(e)}function s(e){2===e._state&&0===e._deferreds.length&&i._immediateFn(function(){e._handled||i._unhandledRejectionFn(e._value)});for(var t=0,n=e._deferreds.length;t<n;t++)a(e,e._deferreds[t]);e._deferreds=null}function f(e,t,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=n}function l(e,t){var n=!1;try{e(function(e){n||(n=!0,u(t,e))},function(e){n||(n=!0,c(t,e))})}catch(e){if(n)return;n=!0,c(t,e)}}i.prototype.catch=function(e){return this.then(null,e)},i.prototype.then=function(e,t){var n=new this.constructor(o);return a(this,new f(e,t,n)),n},i.prototype.finally=function(e){var t=this.constructor;return this.then(function(n){return t.resolve(e()).then(function(){return n})},function(n){return t.resolve(e()).then(function(){return t.reject(n)})})},i.all=function(e){return new i(function(t,n){if(!e||void 0===e.length)throw new TypeError("Promise.all accepts an array");var r=Array.prototype.slice.call(e);if(0===r.length)return t([]);var o=r.length;function i(e,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var u=a.then;if("function"==typeof u)return void u.call(a,function(t){i(e,t)},n)}r[e]=a,0==--o&&t(r)}catch(e){n(e)}}for(var a=0;a<r.length;a++)i(a,r[a])})},i.resolve=function(e){return e&&"object"==typeof e&&e.constructor===i?e:new i(function(t){t(e)})},i.reject=function(e){return new i(function(t,n){n(e)})},i.race=function(e){return new i(function(t,n){for(var r=0,o=e.length;r<o;r++)e[r].then(t,n)})},i._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){r(e,0)},i._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},e.exports=i},function(e,t,n){e.exports=n(3)},function(e,t,n){var r=n(0),o=n(4),i=n(5),a=n(7),u={x:0,y:0};o.sendAction("enter",{referer:document.referrer,href:window.location.href,title:document.title}),r.forEach(["alert","confirm","prompt"],function(e){var t=window[e];window[e]=function(n){o.sendAction(e,{message:n,returnValue:t.call(window,n)})}}),r.forEach(["click","dblclick","contextmenu","change"],function(e){r.addEventListener(document,e,function(t){!function(e){if("SELECT"!==e.target.tagName){var t=e.screenX-e.clientX,n=e.screenY-e.clientY;t&&n&&(u.x=t,u.y=n)}}(t);var n=t.target.getBoundingClientRect(),i={time:Date.now(),rect:{x:n.x+u.x,y:n.y+u.y,width:n.width,height:n.height},text:r.getTextSlice(t.target),element:{tagName:t.target.tagName,type:t.target.type}};"change"===t.type&&(i.value=t.target.value),o.sendAction(e,i)})});var c={data:null,hash:null},s={CHANNEL:{DRAW:"snapshot.draw",CALL:"snapshot.call"},TARGET_ATTRIBUTE:"lc-target",THROTTLE_INTERVAL:200};function f(e){var t=a.setFrameHashAttribute(),n={self:a.create(),map:{}};return a.removeFrameHashAttribute(),r.Promise.all(r.map(t,function(t){try{return t.element.contentWindow.__DRAW_SNAPSHOT(e)}catch(n){return i.request(t.element.contentWindow,s.CHANNEL.DRAW,e).catch(function(){})}})).then(function(e){return r.forEach(e,function(e,r){e&&(n.map[t[r].hash]=e)}),c.data=n})}if(r.addEventListener(document,"mouseover",function(e,t){var n=c.hash=r.hash();t.setAttribute(s.TARGET_ATTRIBUTE,"yes"),f(n).then(function(){t.removeAttribute(s.TARGET_ATTRIBUTE);try{return window.top.__CALL_SNAPSHOT(n)}catch(e){return i.request(window.top,s.CHANNEL.CALL,n,{timeout:50})}})}),i.on(s.CHANNEL.DRAW,window.__DRAW_SNAPSHOT=function(e){return c.hash===e?r.Promise.resolve(c.data):f(e)}),window.top===window.self){var l=null,d=window.__CALL_SNAPSHOT=function(e){clearTimeout(l),l=setTimeout(function(){window.__DRAW_SNAPSHOT(e).then(function(e){o.sendSnapshot(e)})},s.THROTTLE_INTERVAL)};i.on(s.CHANNEL.CALL,d),setTimeout(d,s.THROTTLE_INTERVAL)}},function(e,t,n){var r=n(0);function o(e,t){void 0===t&&(t={});var n=t,o=n.method,i=void 0===o?"get":o,a=n.data,u=void 0===a?void 0:a,c=n.async,s=void 0===c||c,f=new r.XMLHttpRequest;return f.open(i,e),f.setRequestHeader("Content-Type","application/json"),f.setRequestHeader("X-Tracker-Forward","yes"),s?new r.Promise(function(e,t){f.onreadystatechange=function(){4===f.readyState&&(200===f.status?e(f.responseText):t(f.status))},f.onerror=function(e){t(e)},f.send(u)}):(f.send(u),f.response)}t.sendAction=function(e,t){o("/api/action",{method:"post",async:!1,data:JSON.stringify({type:e,data:t})})},t.sendSnapshot=function(e){o("/api/snapshot",{method:"post",async:!1,data:JSON.stringify(e)})}},function(e,t,n){var r=n(6),o={},i=t.channelRegistry={};r.addEventListener(window,"message",function(e){if("string"==typeof e.data){var t;try{if("pmc"!==(t=JSON.parse(e.data)).protocol)return}catch(e){return}var n=e.source,a=t,u=a.id,c=a.request,s=a.response,f=a.channel,l=a.status;if(1!==l)!function(e,t,n){var i=o[e];if(i){var a=i.resolve,u=i.reject,c=i.timeout,s=i.datagram;0===n?a(t):u(r.PMCError(n,t.context,s.channel,t.message)),delete o[e],clearTimeout(c)}}(u,s,l);else{var d=i[f];new r.Promise(function(e,r){d||(t.status=3,r());try{t.status=0,e(d(c,n))}catch(e){t.status=128,r(e.message)}}).then(function(e){t.response=e},function(e){t.response={context:location.href,message:e}}).then(function(){r.postMessage(n,t)})}}}),t.on=function(e,t){if(!r.isFunction(t))throw new Error("Handler should be a function.");i[e]=t},t.off=function(e){delete i[e]},t.request=function(e,t,n,i){var a=void 0===i?{}:i,u=a.timeout,c=void 0===u?3e4:u,s=a.async,f=void 0===s||s,l=r.createDatagram({channel:t,request:n}),d=new r.Promise(function(n,i){var a=l.id;o[a]={resolve:n,reject:i,datagram:l,timeout:setTimeout(function(){l.status=4,delete o[a],i(r.PMCError(4,"Unreachable",t)),console.error(e)},c)}});return r.postMessage(e,l,f),d}},function(e,t,n){var r=!document.createEvent;t.addEventListener=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)},t.postMessage=function(e,t,n){void 0===n&&(n=!0);var o=JSON.stringify(t);r&&n?setTimeout(function(){return e.postMessage(o,"*")},0):e.postMessage(o,"*")},t.Promise=window.Promise||n(1);var o=0;t.createDatagram=function(e){var t=e.channel,n=e.id,r=void 0===n?o++:n,i=e.request,a=void 0===i?void 0:i,u=e.response,c=void 0===u?void 0:u,s=e.status;return{id:r,channel:t,status:void 0===s?1:s,request:a,response:c,protocol:"pmc"}};var i={0:"OK",1:"Connecting",3:"Channel not registered",4:"Timeout",128:"Internal error"};t.PMCError=function(e,t,n,r){var o=new Error(i[e]+" ("+t+")["+n+"]");return r&&(o.message+=" => "+r),o.name="PMCError",o},t.isFunction=function(e){return"function"==typeof e}},function(e,t,n){var r=n(0);t.setFrameHashAttribute=function(){return r.map(document.querySelectorAll("frame, iframe"),function(e){var t=r.hash();return e.setAttribute("lc-hash",t),{element:e,hash:t}})},t.removeFrameHashAttribute=function(){r.forEach(document.querySelectorAll("frame, iframe"),function(e){e.removeAttribute("lc-hash")})},t.create=function(){var e=window.document.documentElement.outerHTML;return r.forEach(document.querySelectorAll("link, script, meta, style"),function(t){e=e.replace(t.outerHTML,"")}),e.replace(/[\r\n]/g,"").replace(/>\s+</g,"><")}}]);